<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSync Pro - Purchase License</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ‚úÖ reCAPTCHA v3 - Replace YOUR_SITE_KEY with your actual key -->
    <!-- Get key from: https://www.google.com/recaptcha/admin/create -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LeJ0k4sAAAAAHbxCseOvn6FAmCDhAuw_X_UEkQC"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üìà</span>
                <h1>TradeSync Pro</h1>
            </div>
            <p class="tagline">Professional Trade Copying Software</p>
        </header>

        <div class="progress-bar">
            <div class="step active">
                <div class="step-number">1</div>
                <span>Select Plan</span>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <span>Your Details</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Payment</span>
            </div>
        </div>

        <main class="main-content">
            <h2 class="section-title">Choose Your License Plan</h2>
            <p class="section-subtitle">Select the subscription duration that works best for you</p>

            <div class="plans-container" id="plansContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading plans...</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>üîí Direct USDT Payment - No Third-Party Fees</p>
            <p class="footer-note">Pay with USDT (TRC20) ‚Ä¢ Activation key will be sent to your email</p>
            <!-- ‚úÖ Add security badge -->
            <p class="footer-security">üõ°Ô∏è Protected by Google reCAPTCHA</p>
        </footer>
    </div>

    <script src="js/app.js"></script>
    <script>
        // ‚úÖ Bot detection: Track suspicious behavior
        let clickCount = 0;
        const clickTimestamps = [];
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // ‚úÖ Load payment info from API
                const info = await PaymentAPI.getPaymentInfo();
                renderPlans(info.plans);
                
                // ‚úÖ Track page load time (bots load instantly)
                window.pageLoadTime = Date.now();
            } catch (error) {
                console.error('Failed to load plans:', error);
                document.getElementById('plansContainer').innerHTML = `
                    <div class="error-message">
                        <p>‚ùå Failed to load plans. Please refresh the page.</p>
                        <button onclick="location.reload()" class="btn btn-primary">Retry</button>
                    </div>
                `;
            }
        });

        function renderPlans(plans) {
            const container = document.getElementById('plansContainer');

            const plansHTML = plans.map((plan) => {
                const isPopular = plan.days === 30;
                return `
                    <div class="plan-card ${isPopular ? 'popular' : ''}" onclick="selectPlan(${plan.days}, ${plan.price})">
                        ${isPopular ? '<div class="popular-badge">Most Popular</div>' : ''}
                        <div class="plan-duration">${plan.days} Days</div>
                        <div class="plan-price">
                            <span class="currency">$</span>
                            <span class="amount">${plan.price}</span>
                            <span class="unit">USDT</span>
                        </div>
                        <div class="plan-perday">$${(plan.price / plan.days).toFixed(2)}/day</div>
                        <ul class="plan-features">
                            <li>‚úì Full Software Access</li>
                            <li>‚úì Unlimited Trade Copying</li>
                            <li>‚úì Email Support</li>
                            ${plan.days >= 20 ? '<li>‚úì Priority Support</li>' : ''}
                            ${plan.days >= 30 ? '<li>‚úì Best Value</li>' : ''}
                        </ul>
                        <button class="btn btn-primary">Select Plan</button>
                    </div>
                `;
            }).join('');

            container.innerHTML = plansHTML;
        }

        async function selectPlan(days, price) {
            // ‚úÖ Bot detection: Check if page just loaded (bots click instantly)
            const timeOnPage = Date.now() - (window.pageLoadTime || Date.now());
            if (timeOnPage < 1000) {
                console.warn('‚ö†Ô∏è Suspiciously fast click detected');
                // Still allow, but flag for later
                sessionStorage.setItem('fastClick', 'true');
            }
            
            // ‚úÖ Bot detection: Track click patterns
            clickCount++;
            clickTimestamps.push(Date.now());
            
            // If more than 3 clicks in 2 seconds, might be bot
            const recentClicks = clickTimestamps.filter(t => Date.now() - t < 2000);
            if (recentClicks.length > 3) {
                console.warn('‚ö†Ô∏è Suspicious clicking pattern detected');
                sessionStorage.setItem('suspiciousClicks', 'true');
            }
            
            // ‚úÖ Store selected plan
            sessionStorage.setItem('selectedPlan', JSON.stringify({ 
                days, 
                price,
                selectedAt: Date.now(),
                timeOnPage: timeOnPage
            }));
            
            // ‚úÖ Generate reCAPTCHA token for next page
            // Note: Replace YOUR_SITE_KEY with your actual site key
            try {
                if (typeof grecaptcha !== 'undefined') {
                    const token = await grecaptcha.execute('6LeJ0k4sAAAAAHbxCseOvn6FAmCDhAuw_X_UEkQC', {action: 'select_plan'});
                    sessionStorage.setItem('captchaToken', token);
                    console.log('‚úÖ reCAPTCHA token generated');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è reCAPTCHA not available:', error);
                // Still allow user to proceed
            }
            
            // Redirect to checkout
            window.location.href = 'checkout.html';
        }
        
        // ‚úÖ Prevent rapid-fire clicking (bot behavior)
        let isSelecting = false;
        const originalSelectPlan = selectPlan;
        selectPlan = async function(days, price) {
            if (isSelecting) {
                console.warn('‚ö†Ô∏è Please wait...');
                return;
            }
            
            isSelecting = true;
            try {
                await originalSelectPlan(days, price);
            } finally {
                setTimeout(() => { isSelecting = false; }, 500);
            }
        };
    </script>
</body>
</html>
